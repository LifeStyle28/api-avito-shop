# API AVITO SHOP
## Запуск
```
docker-compose up --build -d
```
## Запуск с прогоном тестов
Для запуска тестов нужно убедиться, что скрипт `run_tests.sh` имеет права на исполнение.
Скрипт запускает юнит-тесты и интеграционные тесты, поднимая рядом контейнер с `pytest`.
После завершения работы делается `docker-compose down` для того чтобы очистить базу данных, если вдруг нужны будут новые тестовые прогоны.
Запуск тестов из директории производится командой:
```
./run_tests.sh
```
Тесты поддерживают создание уникальных ключей, чтобы избежать повторяемости от теста к тесту -- библиотека `Sequences`.
## Запуск нагрузочных тестов
Запуск производится из директории ammo:
```
docker run -v $(pwd):/var/loadtest -v $SSH_AUTH_SOCK:/ssh-agent -e SSH_AUTH_SOCK=/ssh-agent --net host -it yandex/yandex-tank
```

## TODO
Поскольку это MVP, то перед запуском в прод бы доделал:
* во-первых нагрузочные тесты (не удалось протестить, т.к. нет образа в репозитории для arm64)
* по интеграционным тестам сделать обертку для более удобного создания пользователей и отправки соответствующих запросов к серверу
* не очень нравится, что на каждый "чих" идёт переконнект к БД, нужно сделать поддержку коннекта в рамках хендлинга запроса
* добавить ретраи на подключение к БД, если вдруг по какой-то причине подключение не устанавливается, либо разорвалось
* в коде Go более красиво сделать обёртку, которая работает с продуктовой логикой (engine)
* сделать более понятным хендлинг ошибок, вынести в отедельный хендлер
* когда будет реализован единый коннект в рамках одного запроса, то сделать запросы к БД более точечными, а не как щас чтобы не переконнекчиваться есть методы такие как `GetUserReceivedAndSentCoins`, их надо разделить и тогда будет более гибкая логика, потому что в случае с какими-то ошибками можно выдавать различные статус коды в ответах на запросы
* в качестве MVP взят генератор openapi, немного переделаны зависимости -- перед запуском в прод всё-таки сделать более понятную архитектуру и выкинуть ненужные вещи (линтер местами ругается)
* добавить pprof + сделать observability
